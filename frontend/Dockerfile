# Etapa de build con Vite
FROM node:20 AS build

WORKDIR /app

# Copia package.json y lock para instalar dependencias
COPY package*.json ./
RUN npm install

# Copia todo el proyecto, incluido el .env.production
COPY . .

# ‚ö†Ô∏è Renombrar .env.production para que Vite lo lea autom√°ticamente
RUN cp .env.production .env

# ‚úÖ Verificar que .env se haya copiado correctamente
RUN echo "üß™ Contenido de .env:" && cat .env

# Construye en modo producci√≥n (usar√° el .env autom√°ticamente)
RUN npm run build -- --mode production

# Etapa de producci√≥n: servir con Nginx
FROM nginx:alpine

# Copia los archivos generados por Vite
COPY --from=build /app/dist /usr/share/nginx/html

# Copia configuraci√≥n personalizada si tienes
COPY nginx/default.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
